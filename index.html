<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>UGPhone Stock</title>
  <style>
    :root{
      --bg:#0f0f0f;--card:#252525;--muted:#a1a1a1;--text:#eee;--red:#ff5252;--green:#30e07b;--amber:#ffd54f;
      --glow:0 0 25px rgba(255,82,82,.25);
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;overflow:hidden}
    /* video bg */
    #video-wrap{position:fixed;inset:0;z-index:-1;pointer-events:none}
    #video-wrap iframe{position:absolute;inset:0;width:100%;height:100%;filter:brightness(.45);border:0}
    .bg-fallback{
      position:fixed;inset:0;background:
      radial-gradient(60vw 60vh at 10% 10%, #1b1b1b, transparent 40%),
      radial-gradient(50vw 50vh at 90% 20%, #161616, transparent 40%),
      radial-gradient(40vw 40vh at 50% 90%, #131313, transparent 50%),
      #0c0c0c;
      z-index:-2;
    }
    header{display:flex;gap:.6rem;align-items:center;justify-content:center;padding:18px 10px}
    header h1{margin:0;font-weight:800;letter-spacing:.3px;color:#ff4a4a;text-shadow:0 3px 14px rgba(255,74,74,.35)}
    header .logo{filter:drop-shadow(var(--glow))}
    .shell{max-width:1100px;margin:0 auto;padding:0 16px}
    table{width:100%;border-collapse:collapse;border-radius:14px;overflow:hidden;background:rgba(37,37,37,.88);box-shadow:0 10px 40px rgba(0,0,0,.35)}
    thead th{background:#303030;color:#fff;padding:14px;font-size:17px}
    tbody td{padding:14px;border-top:1px solid #2b2b2b;font-size:16px}
    tbody tr:nth-child(even){background:rgba(255,255,255,.02)}
    .name{font-weight:700;color:#ffe082}
    .status{font-weight:700}
    .status.ok{color:var(--green)}
    .status.bad{color:var(--red)}
    .status.unk{color:var(--muted)}
    .muted{color:var(--muted)}
    .bar{display:flex;gap:10px;align-items:center;justify-content:flex-end;margin:10px 0 16px}
    .btn{
      border:0;background:#1d1d1d;color:#fff;padding:10px 14px;border-radius:10px;cursor:pointer;
      transition:.2s;box-shadow:0 0 0 1px #2a2a2a inset
    }
    .btn:hover{transform:translateY(-1px);box-shadow:0 6px 18px rgba(0,0,0,.4),0 0 0 1px #3a3a3a inset}
    .pill{font-size:13px;padding:6px 10px;border-radius:999px;background:#1a1a1a;border:1px solid #2b2b2b}
    .error{margin:10px 0 0;color:#ff9e9e}
    footer{position:fixed;right:12px;bottom:12px;font-size:12px;color:var(--muted)}
  </style>
</head>
<body>
  <div id="video-wrap"></div>
  <div class="bg-fallback" aria-hidden="true"></div>

  <header class="shell">
    <svg class="logo" width="26" height="26" viewBox="0 0 24 24" fill="none" aria-hidden="true">
      <path d="M3 7.5h18v7.5a3 3 0 0 1-3 3H6a3 3 0 0 1-3-3V7.5Z" stroke="#ff5454" stroke-width="1.8" />
      <path d="M7 7V5a5 5 0 0 1 10 0v2" stroke="#ff5454" stroke-width="1.8"/>
      <circle cx="8" cy="13" r="1.2" fill="#fff"/>
      <circle cx="12" cy="13" r="1.2" fill="#fff"/>
      <circle cx="16" cy="13" r="1.2" fill="#fff"/>
    </svg>
    <h1>UGPhone Stock</h1>
  </header>

  <div class="shell">
    <div class="bar">
      <span id="last" class="pill">‚è± Ch∆∞a c·∫≠p nh·∫≠t</span>
      <button id="sound" class="btn" type="button">üîä B·∫≠t ti·∫øng</button>
    </div>

    <table aria-live="polite">
      <thead>
        <tr>
          <th>Server</th>
          <th>Tr·∫°ng th√°i</th>
        </tr>
      </thead>
      <tbody id="tbody">
        <tr><td class="muted" colspan="2">ƒêang t·∫£i‚Ä¶</td></tr>
      </tbody>
    </table>

    <div id="error" class="error" hidden aria-live="assertive"></div>
  </div>

  <footer>Tip: N·∫øu n·ªÅn video b·ªã tr·∫Øng, trang s·∫Ω t·ª± th·ª≠ n·∫°p l·∫°i sau v√†i gi√¢y.</footer>

  <!-- YouTube Iframe API -->
  <script src="https://www.youtube.com/iframe_api"></script>
  <script>
    const VIDEO_ID = "Sas3Tw_FpnA";
    let player, muted = true, ytReady = false, healTimer;

    function onYouTubeIframeAPIReady(){
      ytReady = true;
      mountYT();
    }
    function mountYT(){
      if(!ytReady) return;
      const wrap = document.getElementById('video-wrap');
      wrap.innerHTML = '<div id="yt-bg"></div>';
      player = new YT.Player('yt-bg',{
        width:'100%', height:'100%', videoId:VIDEO_ID,
        playerVars:{
          autoplay:1, mute:1, loop:1, playlist:VIDEO_ID, controls:0, disablekb:1,
          fs:0, rel:0, iv_load_policy:3, modestbranding:1, playsinline:1
        },
        events:{
          onReady:e => { try{ e.target.mute(); e.target.playVideo(); }catch{} scheduleHeal(); },
          onStateChange: scheduleHeal,
          onError: scheduleHeal
        }
      });
    }
    function scheduleHeal(){
      clearTimeout(healTimer);
      healTimer = setTimeout(()=>{
        try{
          const s = player.getPlayerState();
          // n·∫øu kh√¥ng ph·∫£i ƒëang PLAYING (1) th√¨ remount
          if(s !== 1){ mountYT(); }
        }catch{ mountYT(); }
      }, 8000);
    }
    document.getElementById('sound').onclick = () => {
      if(!player) return;
      try{
        if(muted){ player.unMute(); document.getElementById('sound').textContent = 'üîá T·∫Øt ti·∫øng'; }
        else      { player.mute();   document.getElementById('sound').textContent = 'üîä B·∫≠t ti·∫øng'; }
        muted = !muted;
      }catch{}
    };
  </script>

  <script>
    const PRIMARY_API = "https://meows.io.vn/api/ugphone-status";
    const WORKER_API  = "https://REPLACE_WITH_YOUR_WORKER_URL/ugstock";

    const tbody = document.getElementById("tbody");
    const errorBox = document.getElementById("error");
    const last = document.getElementById("last");

    async function loadStock(){
      try{
        let data = await tryFetch(PRIMARY_API);
        if(!data) data = await tryFetch(WORKER_API, true);
        if(!data) throw new Error("Kh√¥ng nh·∫≠n ƒë∆∞·ª£c d·ªØ li·ªáu t·ª´ c·∫£ API g·ªëc l·∫´n Worker.");

        const rows = normalizeRows(data);
        renderRows(rows);
        markOk();
      }catch(err){
        renderError(err);
      }
    }

    async function tryFetch(url, isProxy=false){
      if(!url || url.includes("REPLACE_WITH_YOUR_WORKER_URL")) return null;
      try{
        const r = await fetch(url, {cache:"no-cache"});
        if(!r.ok) throw new Error(`HTTP ${r.status}`);
        const text = await r.text();
        try{ return JSON.parse(text); } catch{ return text; }
      }catch(e){
        if(!isProxy) console.warn("L·ªói API g·ªëc:", e);
        else console.warn("L·ªói Worker:", e);
        return null;
      }
    }

    function normalizeRows(payload){
      if(Array.isArray(payload)) {
        // n·∫øu payload l√† list object {server, status}
        if(payload.every(x => typeof x==="object" && x.server && x.status)){
          return payload.map(x => `${x.server}:${x.status}`);
        }
        return payload;
      }
      if(typeof payload === "string") return payload.split(/\r?\n/).filter(Boolean);
      if(payload && typeof payload === "object"){
        if(Array.isArray(payload.status)) return payload.status;
        if(Array.isArray(payload.data)) return payload.data;
        if(typeof payload.raw === "string") return payload.raw.split(/\r?\n/).filter(Boolean);
      }
      return [];
    }

    function renderRows(lines){
      if(!lines.length){
        tbody.innerHTML = `<tr><td class="muted" colspan="2">Kh√¥ng c√≥ d·ªØ li·ªáu.</td></tr>`;
        return;
      }
      const fr = document.createDocumentFragment();
      for(const line of lines){
        if(/uptime|tr·∫°ng\s*th√°i/i.test(line) && !/[üü¢üî¥]/.test(line)) continue;

        const [left, rightRaw=""] = String(line).split(/[:\-]/,2);
        const name = (left||"").trim();
        const right = (rightRaw||"").trim();

        let cls="unk", label="‚ùì Kh√¥ng r√µ";
        if(/[üü¢]|online|c√≤n|up|ok/i.test(right)) { cls="ok";  label="üü¢ Online"; }
        else if(/[üî¥]|offline|h·∫øt|down|die/i.test(right)) { cls="bad"; label="üî¥ Offline"; }

        const tr = document.createElement("tr");
        const td1 = document.createElement("td"); td1.className="name"; td1.textContent = name || "(Kh√¥ng t√™n)";
        const td2 = document.createElement("td"); td2.className=`status ${cls}`; td2.textContent = label;
        td2.title = right; // gi·ªØ l·∫°i text g·ªëc ƒë·ªÉ hover xem

        tr.appendChild(td1); tr.appendChild(td2); fr.appendChild(tr);
      }
      tbody.innerHTML = "";
      tbody.appendChild(fr);
    }

    function markOk(){
      errorBox.hidden = true;
      last.textContent = "‚è± C·∫≠p nh·∫≠t: " + new Date().toLocaleTimeString();
    }
    function renderError(err){
      tbody.innerHTML = `<tr><td class="muted" colspan="2">‚ùå L·ªói khi t·∫£i d·ªØ li·ªáu</td></tr>`;
      errorBox.hidden = false;
      errorBox.textContent = "Chi ti·∫øt: " + (err && err.message ? err.message : err);
    }

    loadStock();
    setInterval(loadStock, 12000); // refresh 12 gi√¢y
  </script>
</body>
</html>
